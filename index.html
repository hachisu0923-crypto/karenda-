<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>My Calendar</title>
  <link rel="stylesheet" href="style.css" />
  <!-- Supabase JS SDK -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>

<!-- ═══════════ AUTH SCREEN ═══════════ -->
<div id="js-auth-screen" class="auth-screen">
  <div class="auth-card">
    <div class="auth-logo">📅</div>
    <h1 class="auth-title">My Calendar</h1>
    <p class="auth-sub">ログインしてどのデバイスからでも同期</p>

    <div id="js-auth-error" class="auth-error" style="display:none"></div>

    <!-- Tab -->
    <div class="auth-tab-bar">
      <button class="auth-tab is-active" data-tab="login">ログイン</button>
      <button class="auth-tab" data-tab="signup">新規登録</button>
    </div>

    <div class="auth-form">
      <div class="form-row">
        <label class="form-label" for="js-auth-email">メールアドレス</label>
        <input class="form-input" type="email" id="js-auth-email" placeholder="you@example.com" autocomplete="email" />
      </div>
      <div class="form-row">
        <label class="form-label" for="js-auth-password">パスワード</label>
        <input class="form-input" type="password" id="js-auth-password" placeholder="••••••••" autocomplete="current-password" />
      </div>
      <button class="btn-primary" id="js-auth-submit" style="margin-top:8px">ログイン</button>
    </div>

    <div class="auth-divider"><span>または</span></div>
    <button class="btn-oauth" id="js-auth-google">
      <svg width="16" height="16" viewBox="0 0 48 48"><path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"/><path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/><path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"/><path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/></svg>
      Googleでログイン
    </button>

    <p class="auth-loading" id="js-auth-loading" style="display:none">処理中...</p>
  </div>
</div>

<!-- ═══════════ APP (hidden until auth) ═══════════ -->
<div id="js-app" style="display:none">

<div class="layout">

  <!-- ═══ SIDEBAR ═══ -->
  <aside class="sidebar">
    <div class="sidebar-header">
      <div class="sidebar-logo">📅</div>
      <span class="sidebar-title">My Calendar</span>
    </div>

    <div class="mini-cal">
      <div class="mini-cal-header">
        <button class="mini-nav-btn" id="js-mini-prev">‹</button>
        <span class="mini-cal-month" id="js-mini-month"></span>
        <button class="mini-nav-btn" id="js-mini-next">›</button>
      </div>
      <div class="mini-weekdays">
        <span class="mini-wd">日</span><span class="mini-wd">月</span>
        <span class="mini-wd">火</span><span class="mini-wd">水</span>
        <span class="mini-wd">木</span><span class="mini-wd">金</span>
        <span class="mini-wd">土</span>
      </div>
      <div class="mini-grid" id="js-mini-grid"></div>
    </div>

    <div class="sidebar-divider"></div>

    <span class="sidebar-section-label">カテゴリ</span>
    <div class="category-list" id="js-category-list"></div>
    <button class="sidebar-btn" id="js-open-cat-editor">
      <span style="font-size:16px;line-height:1">+</span>
      <span>カテゴリを編集</span>
    </button>

    <div class="sidebar-divider"></div>

    <span class="sidebar-section-label">今月の給料</span>
    <div class="salary-summary" id="js-salary-summary"></div>

    <div style="flex:1"></div>

    <!-- User info + logout -->
    <div class="sidebar-divider"></div>
    <div class="user-row">
      <span class="user-email" id="js-user-email"></span>
      <button class="btn-logout" id="js-logout">ログアウト</button>
    </div>
  </aside>

  <!-- ═══ MAIN ═══ -->
  <div class="main">
    <header class="topbar">
      <div class="topbar-left">
        <div class="topbar-nav">
          <button class="btn-icon" id="js-prev-month">‹</button>
          <button class="btn-text" id="js-today">今日</button>
          <button class="btn-icon" id="js-next-month">›</button>
        </div>
        <div>
          <div class="topbar-title" id="js-topbar-title"></div>
          <div class="topbar-sub"   id="js-topbar-sub"></div>
        </div>
      </div>
      <div class="topbar-right">
        <!-- Sync indicator -->
        <span class="sync-indicator" id="js-sync-indicator" title="同期状態"></span>
        <button class="btn-theme" id="js-theme-toggle" title="テーマ切替"></button>
      </div>
    </header>

    <div class="calendar-wrap">
      <div class="calendar">
        <div class="weekdays-row">
          <div class="weekday-head is-sun">Sun</div>
          <div class="weekday-head">Mon</div>
          <div class="weekday-head">Tue</div>
          <div class="weekday-head">Wed</div>
          <div class="weekday-head">Thu</div>
          <div class="weekday-head">Fri</div>
          <div class="weekday-head is-sat">Sat</div>
        </div>
        <div class="cal-grid" id="js-cal-grid"></div>
      </div>
    </div>
  </div>

</div><!-- /.layout -->

</div><!-- /#js-app -->


<!-- ═══════════ DAY MODAL ═══════════ -->
<div class="overlay" id="js-day-overlay">
  <div class="modal">
    <div class="modal-header">
      <div>
        <div class="modal-header-title" id="js-day-modal-title"></div>
        <div class="modal-header-sub"   id="js-day-modal-sub"></div>
      </div>
      <button class="modal-close-btn" id="js-day-modal-close">✕</button>
    </div>
    <div class="modal-body">
      <div id="js-existing-events"></div>

      <div class="form-tab-bar">
        <button class="form-tab is-active" data-tab="event">予定を追加</button>
        <button class="form-tab" data-tab="shift" id="js-shift-tab">シフトを追加</button>
      </div>

      <!-- Normal event form -->
      <div class="add-section" id="js-tab-event">
        <div class="form-row">
          <label class="form-label" for="js-ev-title">タイトル</label>
          <input class="form-input" type="text" id="js-ev-title" placeholder="予定のタイトル" autocomplete="off" />
        </div>
        <div class="form-row">
          <label class="form-label" for="js-ev-time">時間（任意）</label>
          <input class="form-input" type="time" id="js-ev-time" />
        </div>
        <div class="form-row">
          <label class="form-label">カテゴリ</label>
          <div class="cat-chip-list" id="js-cat-chip-list"></div>
        </div>
        <button class="btn-primary" id="js-add-event-btn">＋ 追加</button>
      </div>

      <!-- Shift form -->
      <div class="add-section" id="js-tab-shift" style="display:none">
        <div class="form-row" id="js-template-row" style="display:none">
          <label class="form-label">よく使うシフト</label>
          <div class="template-chip-list" id="js-template-chip-list"></div>
        </div>
        <div class="form-row form-row-2col">
          <div>
            <label class="form-label" for="js-shift-start">開始時刻</label>
            <input class="form-input" type="time" id="js-shift-start" />
          </div>
          <div>
            <label class="form-label" for="js-shift-end">終了時刻</label>
            <input class="form-input" type="time" id="js-shift-end" />
          </div>
        </div>
        <div class="form-row">
          <label class="form-label" for="js-shift-break">休憩時間（分）</label>
          <input class="form-input" type="number" id="js-shift-break" placeholder="0" min="0" max="480" />
        </div>
        <div class="wage-preview" id="js-wage-preview">
          <div class="wage-preview-row">
            <span class="wage-preview-label">勤務時間</span>
            <span class="wage-preview-val" id="js-preview-hours">—</span>
          </div>
          <div class="wage-preview-row">
            <span class="wage-preview-label">休憩（控除）</span>
            <span class="wage-preview-val" id="js-preview-break">—</span>
          </div>
          <div class="wage-preview-divider"></div>
          <div class="wage-preview-row">
            <span class="wage-preview-label">予想給料</span>
            <span class="wage-preview-amount" id="js-preview-pay">—</span>
          </div>
        </div>
        <div class="no-shift-warning" id="js-no-shift-warning" style="display:none">
          バイトカテゴリがまだ設定されていません。<br>
          <button class="link-btn" id="js-go-to-cat-editor">カテゴリを編集する →</button>
        </div>
        <button class="btn-primary" id="js-add-shift-btn">＋ シフト追加</button>
      </div>
    </div>
  </div>
</div>

<!-- ═══════════ CATEGORY EDITOR MODAL ═══════════ -->
<div class="overlay" id="js-cat-overlay">
  <div class="modal modal-sm">
    <div class="modal-header">
      <div>
        <div class="modal-header-title">カテゴリの管理</div>
        <div class="modal-header-sub">バイトにはシフトテンプレートと時給を設定できます</div>
      </div>
      <button class="modal-close-btn" id="js-cat-modal-close">✕</button>
    </div>
    <div class="modal-body">
      <div id="js-cat-editor-list"></div>
      <button class="add-cat-row" id="js-add-cat-row">
        <span style="font-size:16px;line-height:1">+</span>
        <span>カテゴリを追加</span>
      </button>
    </div>
    <div class="modal-footer">
      <button class="btn-secondary" id="js-cat-cancel-btn">キャンセル</button>
      <button class="btn-primary" style="width:auto;padding:7px 18px;" id="js-cat-save-btn">保存する</button>
    </div>
  </div>
</div>

<!-- ═══════════ COLOR PICKER POPUP ═══════════ -->
<div class="color-popup" id="js-color-popup">
  <div class="color-popup-label">カラーを選択</div>
  <div class="color-swatch-grid" id="js-color-swatch-grid"></div>
  <div class="custom-color-row">
    <span class="custom-color-label">カスタムカラー</span>
    <input class="custom-color-input" type="color" id="js-custom-color-input" />
  </div>
</div>

<script src="app.js"></script>
</body>
</html>
